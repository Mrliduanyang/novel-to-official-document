<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ†é¡µé€»è¾‘æµ‹è¯•</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #f5f5f5;
            padding: 20px;
            font-family: "FangSong_GB2312", "ä»¿å®‹_GB2312", "FangSong", "ä»¿å®‹", serif;
        }

        .controls {
            max-width: 800px;
            margin: 0 auto 20px;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .controls h2 {
            margin-bottom: 15px;
            color: #c8161d;
        }

        .controls button {
            padding: 10px 20px;
            background-color: #c8161d;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
        }

        .controls button:hover {
            background-color: #a01318;
        }

        .stats {
            margin-top: 15px;
            padding: 10px;
            background: #f0f0f0;
            border-radius: 4px;
        }

        .document-container {
            max-width: 210mm;
            margin: 0 auto;
        }

        .page {
            width: 210mm;
            height: 297mm;
            margin: 0 auto 20px;
            background: white;
            padding: 37mm 26mm 35mm 28mm;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            position: relative;
            page-break-after: always;
            box-sizing: border-box;
            overflow: hidden;
        }

        .page:last-child {
            page-break-after: auto;
        }

        /* çº¢å¤´éƒ¨åˆ† */
        .header {
            text-align: center;
            margin-bottom: 20mm;
        }

        .header-title {
            font-size: 22pt;
            font-weight: bold;
            color: #c8161d;
            letter-spacing: 2px;
            margin-bottom: 3mm;
            font-family: "SimHei", "é»‘ä½“", sans-serif;
        }

        .header-line {
            width: 100%;
            height: 0.5mm;
            background-color: #c8161d;
            margin: 5mm 0;
        }

        /* æ–‡å· */
        .document-number {
            text-align: center;
            font-size: 16pt;
            margin-bottom: 8mm;
            font-family: "FangSong_GB2312", "ä»¿å®‹_GB2312", "FangSong", "ä»¿å®‹", serif;
        }

        /* æ ‡é¢˜ */
        .title {
            text-align: center;
            font-size: 22pt;
            font-weight: bold;
            margin-bottom: 10mm;
            line-height: 1.5;
            font-family: "SimHei", "é»‘ä½“", sans-serif;
        }

        /* æ­£æ–‡ */
        .content {
            font-size: 16pt;
            line-height: 2;
            text-align: justify;
            font-family: "FangSong_GB2312", "ä»¿å®‹_GB2312", "FangSong", "ä»¿å®‹", serif;
        }

        .content p {
            margin-bottom: 1em;
            text-indent: 2em;
        }

        /* è½æ¬¾ */
        .signature {
            text-align: right;
            font-size: 16pt;
            margin-top: 10mm;
            font-family: "FangSong_GB2312", "ä»¿å®‹_GB2312", "FangSong", "ä»¿å®‹", serif;
        }

        .signature-unit {
            margin-bottom: 8mm;
        }

        .signature-date {
            margin-right: 20mm;
        }

        /* é¡µç  */
        .page-number {
            position: absolute;
            bottom: 15mm;
            left: 50%;
            transform: translateX(-50%);
            font-size: 14pt;
            font-family: "FangSong_GB2312", "ä»¿å®‹_GB2312", "FangSong", "ä»¿å®‹", serif;
        }

        /* é«˜åº¦æ ‡å°º - ç”¨äºå¯è§†åŒ–è°ƒè¯• */
        .page.with-ruler::before {
            content: '';
            position: absolute;
            left: 5mm;
            top: 40mm;
            bottom: 30mm;
            width: 2px;
            background: repeating-linear-gradient(
                to bottom,
                red 0px,
                red 2px,
                transparent 2px,
                transparent 10mm
            );
            opacity: 0.3;
        }

        .source-content {
            display: none;
        }
    </style>
</head>
<body>
    <div class="controls">
        <h2>ğŸ“ åˆ†é¡µé€»è¾‘æµ‹è¯•</h2>
        <button onclick="runTest()">ğŸš€ è¿è¡Œæµ‹è¯•</button>
        <button onclick="toggleRuler()">ğŸ“ æ˜¾ç¤º/éšè—æ ‡å°º</button>
        <button onclick="window.print()">ğŸ–¨ï¸ æ‰“å°é¢„è§ˆ</button>
        <div class="stats" id="stats">
            ç‚¹å‡»"è¿è¡Œæµ‹è¯•"å¼€å§‹æµ‹è¯•åˆ†é¡µåŠŸèƒ½
        </div>
    </div>

    <div id="result"></div>

    <!-- æºå†…å®¹ -->
    <div class="source-content" id="sourceContent">
        <h1>ç„å¹»ä¿®ä»™ä¼ </h1>
        <h3>ç¬¬ä¸€ç«  å¤©é™å¼‚è±¡</h3>
        <div class="content">
            <p>ä¸œç„å¤§é™†ï¼Œé’äº‘å±±è„‰æ·±å¤„ï¼Œä¸€é“ç’€ç’¨çš„é‡‘å…‰ä»å¤©è€Œé™ï¼Œç…§äº®äº†æ•´ä¸ªå¤œç©ºã€‚</p>
            <p>æäº‘ç›˜ååœ¨å±±æ´ä¸­ï¼Œçªç„¶çå¼€åŒçœ¼ï¼Œçœ¼ä¸­é—ªè¿‡ä¸€é“ç²¾å…‰ã€‚ä»–æ„Ÿè§‰åˆ°ä½“å†…çš„çµåŠ›æ­£åœ¨ç–¯ç‹‚è¿è½¬ï¼Œä¸€è‚¡å‰æ‰€æœªæœ‰çš„åŠ›é‡æ­£åœ¨è§‰é†’ã€‚</p>
            <p>"è¿™æ˜¯...å¤©åœ°å¼‚è±¡ï¼Ÿ"æäº‘å¿ƒä¸­éœ‡æƒŠï¼Œç«‹åˆ»è¿è½¬åŠŸæ³•ï¼Œå¼•å¯¼è¿™è‚¡çªç„¶å‡ºç°çš„èƒ½é‡ã€‚</p>
            <p>ä¸‰å¹´å‰ï¼Œä»–æ„å¤–ç©¿è¶Šåˆ°è¿™ä¸ªä¿®ä»™ä¸–ç•Œï¼Œæˆä¸ºé’äº‘å®—çš„ä¸€åå¤–é—¨å¼Ÿå­ã€‚å‡­å€Ÿå‰ä¸–çš„è®°å¿†å’Œè¿™ä¸ªä¸–ç•Œçš„ä¿®ç‚¼ä½“ç³»ï¼Œä»–åˆ»è‹¦ä¿®ç‚¼ï¼Œç»ˆäºåœ¨ä»Šæ—¥è¿æ¥äº†çªç ´çš„å¥‘æœºã€‚</p>
            <p>éšç€åŠŸæ³•çš„è¿è½¬ï¼Œå‘¨å›´çš„å¤©åœ°çµæ°”ç–¯ç‹‚åœ°æ¶Œå…¥æäº‘ä½“å†…ã€‚ä»–çš„ä¿®ä¸ºä»¥è‚‰çœ¼å¯è§çš„é€Ÿåº¦æå‡ç€ï¼Œä»ç‚¼æ°”æœŸä¹å±‚ï¼Œç›´æ¥å†²ç ´ç“¶é¢ˆï¼Œè¿›å…¥äº†ç­‘åŸºæœŸï¼</p>
            <p>ç­‘åŸºæœŸï¼Œè¿™æ˜¯ä¿®ä»™è€…çš„ç¬¬ä¸€ä¸ªå¤§å¢ƒç•Œã€‚æ— æ•°ä¿®å£«ç»ˆå…¶ä¸€ç”Ÿéƒ½æ— æ³•è·¨è¶Šè¿™é“é—¨æ§›ï¼Œè€Œæäº‘ä»…ç”¨äº†ä¸‰å¹´æ—¶é—´å°±è¾¾åˆ°äº†è¿™ä¸ªå¢ƒç•Œã€‚</p>
            <p>"è½°ï¼"ä¸€å£°å·¨å“ï¼Œå±±æ´å¤–ä¼ æ¥å‰§çƒˆçš„éœ‡åŠ¨ã€‚æäº‘è¿…é€Ÿæ”¶åŠŸï¼Œè­¦æƒ•åœ°çœ‹å‘æ´å£ã€‚</p>
            <p>åªè§ä¸€é“é»‘å½±ä»å¤©è€Œé™ï¼Œé‡é‡åœ°ç ¸åœ¨å±±æ´å‰çš„ç©ºåœ°ä¸Šã€‚é‚£æ˜¯ä¸€ä¸ªèº«ç©¿é»‘è¢çš„ä¸­å¹´ç”·å­ï¼Œæ­¤åˆ»æ­£æ°”æ¯å¥„å¥„ï¼Œèº«ä¸Šä¼¤ç—•ç´¯ç´¯ã€‚</p>
            <p>"å’³å’³...æƒ³ä¸åˆ°æˆ‘çºµæ¨ªä¸€ä¸–ï¼Œç«Ÿä¼šè½å¾—å¦‚æ­¤ä¸‹åœºã€‚"é»‘è¢ç”·å­æƒ¨ç¬‘ä¸€å£°ï¼Œçªç„¶çœ‹å‘æäº‘ï¼Œ"å°å­ï¼Œæœ‰ç¼˜è§åˆ°æœ¬åº§æœ€åä¸€é¢ï¼Œæ˜¯ä½ çš„é€ åŒ–ã€‚"</p>
            <p>æäº‘è°¨æ…åœ°åé€€ä¸€æ­¥ï¼Œè¿èµ·åˆšåˆšçªç ´çš„ç­‘åŸºæœŸä¿®ä¸ºï¼Œéšæ—¶å‡†å¤‡åº”å¯¹çªå‘æƒ…å†µã€‚</p>
            <p>é»‘è¢ç”·å­æ‘†äº†æ‘†æ‰‹ï¼Œ"æ”¾å¿ƒï¼Œæœ¬åº§å·²æ˜¯å¼ºå¼©ä¹‹æœ«ï¼Œä¼¤ä¸äº†ä½ ã€‚å€’æ˜¯ä½ ï¼Œåˆšåˆšçªç ´ç­‘åŸºï¼Œæ ¹åŸºå´å¼‚å¸¸æ‰å®ï¼Œæ˜¯ä¸ªå¥½è‹—å­ã€‚"</p>
            <p>è¯´ç€ï¼Œä»–ä¼¸æ‰‹ä»æ€€ä¸­å–å‡ºä¸€æšå¤æœ´çš„ç‰ç®€å’Œä¸€ä¸ªå‚¨ç‰©è¢‹ï¼Œ"è¿™æ˜¯æœ¬åº§ä¸€ç”Ÿæ‰€å­¦å’Œç§¯è“„ï¼Œä»Šæ—¥ä¾¿ä¼ ç»™ä½ äº†ã€‚è®°ä½ï¼Œä¿®é“ä¹‹è·¯ï¼Œé€†å¤©è€Œè¡Œï¼Œåˆ‡ä¸å¯å¿ƒå­˜å–„å¿µã€‚"</p>
            <p>è¯éŸ³åˆšè½ï¼Œé»‘è¢ç”·å­èº«ä¸Šçš„æ°”æ¯å½»åº•æ¶ˆæ•£ï¼ŒåŒ–ä½œä¸€é“é»‘çƒŸé£˜æ•£è€Œå»ï¼Œåªç•™ä¸‹é‚£æšç‰ç®€å’Œå‚¨ç‰©è¢‹é™é™åœ°èººåœ¨åœ°ä¸Šã€‚</p>
            <p>æäº‘ç«™åœ¨åŸåœ°ï¼Œä¹…ä¹…æ²¡æœ‰åŠ¨ä½œã€‚è‰¯ä¹…ï¼Œä»–æ‰ç¼“ç¼“èµ°ä¸Šå‰å»ï¼Œæ¡èµ·äº†é‚£ä¸¤ä»¶ä¸œè¥¿ã€‚</p>
            <p>ç¥è¯†æ¢å…¥ç‰ç®€ï¼Œä¸€æ®µæ®µç„å¥¥çš„ä¿¡æ¯æ¶Œå…¥è„‘æµ·ã€‚è¿™ç«Ÿç„¶æ˜¯ä¸€éƒ¨åœ°é˜¶ä¸Šå“åŠŸæ³•ã€Šè¡€ç…é­”åŠŸã€‹ï¼Œä»¥åŠé…å¥—çš„æ­¦æŠ€å’Œç‚¼ä¸¹ã€ç‚¼å™¨ä¹‹æ³•ã€‚</p>
            <p>å†æ‰“å¼€å‚¨ç‰©è¢‹ï¼Œé‡Œé¢ç³ç…æ»¡ç›®çš„å®ç‰©è®©æäº‘å€’å¸ä¸€å£å‡‰æ°”ã€‚å„ç§ä¸¹è¯ã€çµçŸ³ã€æ³•å™¨ï¼Œæ•°ä¸èƒœæ•°ã€‚è¿™ä½å‰è¾ˆç”Ÿå‰å®šç„¶æ˜¯ä¸€ä½äº†ä¸å¾—çš„å¼ºè€…ã€‚</p>
            <p>"é­”é“åŠŸæ³•ä¹ˆ..."æäº‘å–ƒå–ƒè‡ªè¯­ã€‚åœ¨ä¿®ä»™ç•Œï¼Œæ­£é“ä¸é­”é“æ³¾æ¸­åˆ†æ˜ï¼Œè‹¥æ˜¯è¢«äººå‘ç°ä¿®ç‚¼é­”åŠŸï¼Œå¿…é­è¿½æ€ã€‚</p>
            <p>ä½†è½¬å¿µä¸€æƒ³ï¼Œå¦‚ä»Šä»–å·²çªç ´ç­‘åŸºï¼Œæ­£éœ€è¦æ›´é«˜æ·±çš„åŠŸæ³•æ¥å·©å›ºå¢ƒç•Œã€‚è€Œä¸”ï¼ŒåŠŸæ³•æœ¬èº«æ— æ­£é‚ªä¹‹åˆ†ï¼Œå…³é”®åœ¨äºä¿®ç‚¼ä¹‹äººçš„å¿ƒæ€§ã€‚</p>
            <p>åšå‡ºå†³å®šåï¼Œæäº‘ç›˜è†åä¸‹ï¼Œå¼€å§‹ç ”è¯»è¿™éƒ¨ã€Šè¡€ç…é­”åŠŸã€‹ã€‚éšç€åŠŸæ³•çš„è¿è½¬ï¼Œä»–æƒŠè®¶åœ°å‘ç°ï¼Œè¿™éƒ¨é­”åŠŸç«Ÿä¸è‡ªå·±çš„ä½“è´¨å¼‚å¸¸å¥‘åˆï¼Œä¿®ç‚¼é€Ÿåº¦æ¯”ä¹‹å‰å¿«äº†æ•°å€ã€‚</p>
            <p>å°±åœ¨è¿™æ—¶ï¼Œè¿œå¤„ä¼ æ¥ç ´ç©ºä¹‹å£°ã€‚æ•°é“å¼ºå¤§çš„æ°”æ¯æ­£åœ¨å¿«é€Ÿæ¥è¿‘ï¼Œæ˜¾ç„¶æ˜¯å†²ç€åˆšæ‰çš„å¼‚è±¡è€Œæ¥ã€‚</p>
            <p>"ä¸å¥½ï¼Œå¿…é¡»å°½å¿«ç¦»å¼€è¿™é‡Œã€‚"æäº‘è¿…é€Ÿæ”¶æ‹¾å¥½ä¸€åˆ‡ï¼Œæ–½å±•è½»åŠŸå‘å±±è„‰æ·±å¤„éå»ã€‚</p>
            <p>ä»–çŸ¥é“ï¼Œä»ä»Šæ—¥èµ·ï¼Œä»–çš„ä¿®ä»™ä¹‹è·¯å°†ä¼šå……æ»¡è†æ£˜å’Œæ€æœºã€‚ä½†ä»–ä¸æƒ§ï¼Œå› ä¸ºä»–æœ‰ç€ç©¿è¶Šè€…çš„ä¼˜åŠ¿ï¼Œæœ‰ç€ç³»ç»Ÿçš„å¸®åŠ©ï¼Œè¿˜æœ‰è¿™æ„å¤–è·å¾—çš„ä¼ æ‰¿ã€‚</p>
            <p>å¤œè‰²ä¸­ï¼Œæäº‘çš„èº«å½±æ¸è¡Œæ¸è¿œï¼Œå¾ˆå¿«æ¶ˆå¤±åœ¨èŒ«èŒ«å±±æ—ä¹‹ä¸­ã€‚è€Œåœ¨ä»–èº«åï¼Œé‚£äº›è¿½å¯»å¼‚è±¡è€Œæ¥çš„ä¿®å£«ä»¬ï¼Œæ³¨å®šä¸€æ— æ‰€è·ã€‚</p>
            <p>é’äº‘å±±è„‰ï¼Œåªæ˜¯ä¸œç„å¤§é™†çš„ä¸€éš…ã€‚è€Œæäº‘çš„ä¿®ä»™ä¹‹æ—…ï¼Œæ‰åˆšåˆšå¼€å§‹ã€‚</p>
            <p>ä¸‰æ—¥åï¼Œæäº‘å‡ºç°åœ¨è·ç¦»é’äº‘å±±è„‰ç™¾é‡Œä¹‹å¤–çš„åŠå¸‚ä¸­ã€‚è¿™é‡Œæ˜¯ä¿®å£«ä»¬äº¤æ˜“ç‰©å“ã€æ¥å–ä»»åŠ¡çš„åœ°æ–¹ï¼Œé±¼é¾™æ··æ‚ï¼Œå€’æ˜¯ä¸ªéšè—èº«ä»½çš„å¥½å»å¤„ã€‚</p>
            <p>ä»–æ¢ä¸Šä¸€èº«æ™®é€šçš„é’è‰²é•¿è¢ï¼Œå‹ä½ä¿®ä¸ºï¼Œæ··å…¥äººç¾¤ä¹‹ä¸­ã€‚é¦–å…ˆè¦åšçš„ï¼Œæ˜¯å°†å‚¨ç‰©è¢‹ä¸­çš„ä¸€äº›çè´µä½†å®¹æ˜“æƒ¹äººæ³¨ç›®çš„ä¸œè¥¿å¤„ç†æ‰ï¼Œæ¢æˆçµçŸ³å’Œä¿®ç‚¼èµ„æºã€‚</p>
            <p>åŠå¸‚ä¸­äººå£°é¼æ²¸ï¼Œå„ç§å«å–å£°æ­¤èµ·å½¼ä¼ã€‚æäº‘æ¼«æ­¥å…¶é—´ï¼Œä¸€è¾¹è§‚å¯Ÿå‘¨å›´çš„æƒ…å†µï¼Œä¸€è¾¹æ€ç´¢ç€æ¥ä¸‹æ¥çš„è®¡åˆ’ã€‚</p>
            <p>"è¿™ä½é“å‹ï¼Œçœ‹æ‚¨é¢ç”Ÿï¼Œæ˜¯ç¬¬ä¸€æ¬¡æ¥åŠå¸‚å§ï¼Ÿ"ä¸€ä¸ªå£°éŸ³çªç„¶åœ¨è€³è¾¹å“èµ·ã€‚</p>
            <p>æäº‘è½¬å¤´ï¼Œçœ‹åˆ°ä¸€ä¸ªç¬‘å®¹å¯æ¬çš„å¹´è½»ä¿®å£«æ­£çœ‹ç€è‡ªå·±ã€‚æ­¤äººä¿®ä¸ºåœ¨ç‚¼æ°”æœŸä¸ƒå±‚å·¦å³ï¼Œçœ‹èµ·æ¥å¹¶æ— æ¶æ„ã€‚</p>
            <p>"æ­£æ˜¯ï¼Œåœ¨ä¸‹æäº‘ï¼Œåˆæ¥ä¹åˆ°ï¼Œè¿˜è¯·é“å‹å¤šå¤šæŒ‡æ•™ã€‚"æäº‘æŠ±æ‹³å›ç¤¼ï¼Œä¸åŠ¨å£°è‰²åœ°ä¿æŒç€è·ç¦»ã€‚</p>
        </div>
    </div>

    <script>
        let showRuler = false;

        // åŠ¨æ€è®¡ç®—å†…å®¹é«˜åº¦å¹¶åˆ†é¡µ
        function splitContentIntoPages(paragraphs) {
            console.log('===== å¼€å§‹åˆ†é¡µè®¡ç®— =====');
            console.log(`æ€»æ®µè½æ•°: ${paragraphs.length}`);
            
            // åˆ›å»ºä¸å¯è§çš„æµ‹é‡å®¹å™¨
            const tempContainer = document.createElement('div');
            tempContainer.style.cssText = `
                position: absolute;
                visibility: hidden;
                width: 156mm;
                font-size: 16pt;
                line-height: 2;
                font-family: "FangSong_GB2312", "ä»¿å®‹_GB2312", "FangSong", "ä»¿å®‹", serif;
            `;
            document.body.appendChild(tempContainer);
            
            // å®šä¹‰é¡µé¢é«˜åº¦é™åˆ¶ï¼ˆå•ä½ï¼šmmï¼‰
            const PAGE_HEIGHT_MM = 225;      // A4æ€»å¯ç”¨é«˜åº¦ = 297 - 37(ä¸Š) - 35(ä¸‹)
            const LAST_PAGE_HEIGHT_MM = 195; // æœ€åé¡µ = 225 - 30(è½æ¬¾)
            const MM_TO_PX = 3.7795275591;   // 1mm = 3.78px (96dpi)
            
            // åŠ¨æ€æµ‹é‡ç¬¬ä¸€é¡µçš„çº¢å¤´ã€æ–‡å·ã€æ ‡é¢˜é«˜åº¦
            const headerContainer = document.createElement('div');
            headerContainer.style.cssText = `
                position: absolute;
                visibility: hidden;
                width: 156mm;
            `;
            document.body.appendChild(headerContainer);
            
            // çº¢å¤´éƒ¨åˆ†
            const header = document.createElement('div');
            header.style.cssText = 'text-align: center; margin-bottom: 20mm;';
            header.innerHTML = `
                <div style="font-size: 22pt; font-weight: bold; color: #c8161d; letter-spacing: 2px; margin-bottom: 3mm; font-family: SimHei, é»‘ä½“, sans-serif;">XXçœç½‘ç»œæ–‡å­¦ç®¡ç†å§”å‘˜ä¼š</div>
                <div style="width: 100%; height: 0.5mm; background-color: #c8161d; margin: 5mm 0;"></div>
            `;
            headerContainer.appendChild(header);
            
            // æ–‡å·
            const docNumber = document.createElement('div');
            docNumber.style.cssText = 'text-align: center; font-size: 16pt; margin-bottom: 8mm; font-family: "FangSong_GB2312", "ä»¿å®‹_GB2312", "FangSong", "ä»¿å®‹", serif;';
            docNumber.textContent = 'Xç½‘æ–‡ã€”2026ã€•1å·';
            headerContainer.appendChild(docNumber);
            
            // æ ‡é¢˜
            const title = document.createElement('div');
            title.style.cssText = 'text-align: center; font-size: 22pt; font-weight: bold; margin-bottom: 10mm; line-height: 1.5; font-family: SimHei, é»‘ä½“, sans-serif;';
            title.textContent = 'æµ‹è¯•æ ‡é¢˜';
            headerContainer.appendChild(title);
            
            const headerHeight = headerContainer.offsetHeight;
            document.body.removeChild(headerContainer);
            
            const FIRST_PAGE_HEIGHT_MM = (PAGE_HEIGHT_MM * MM_TO_PX - headerHeight) / MM_TO_PX;
            
            console.log(`åŠ¨æ€æµ‹é‡ç»“æœ:`);
            console.log(`  çº¢å¤´+æ–‡å·+æ ‡é¢˜é«˜åº¦: ${headerHeight.toFixed(2)}px (${(headerHeight / MM_TO_PX).toFixed(2)}mm)`);
            console.log(`  ç¬¬ä¸€é¡µå¯ç”¨é«˜åº¦: ${FIRST_PAGE_HEIGHT_MM.toFixed(2)}mm`);
            console.log(`  æ™®é€šé¡µå¯ç”¨é«˜åº¦: ${PAGE_HEIGHT_MM}mm`);
            console.log(`  æœ€åé¡µå¯ç”¨é«˜åº¦: ${LAST_PAGE_HEIGHT_MM}mm`);
            
            // é¢„å…ˆæµ‹é‡æ‰€æœ‰æ®µè½çš„é«˜åº¦ï¼ˆåŒ…æ‹¬marginï¼‰
            const paragraphHeights = paragraphs.map((para, index) => {
                const p = document.createElement('p');
                p.style.cssText = 'margin-bottom: 1em; text-indent: 2em; font-size: 16pt; line-height: 2;';
                p.textContent = para;
                tempContainer.appendChild(p);
                
                // offsetHeightä¸åŒ…å«marginï¼Œéœ€è¦æ‰‹åŠ¨è®¡ç®—
                const height = p.offsetHeight;
                const computedStyle = window.getComputedStyle(p);
                const marginBottom = parseFloat(computedStyle.marginBottom);
                
                tempContainer.removeChild(p);
                console.log(`æ®µè½${index + 1}: å†…å®¹=${height.toFixed(2)}px, ä¸‹è¾¹è·=${marginBottom.toFixed(2)}px (${(height / MM_TO_PX).toFixed(2)}mm)`);
                
                // è¿”å›å†…å®¹é«˜åº¦å’Œä¸‹è¾¹è·ï¼Œåˆ†å¼€å­˜å‚¨
                return {
                    contentHeight: height,
                    marginBottom: marginBottom,
                    totalHeight: height + marginBottom
                };
            });
            
            // æ¸…ç†æµ‹é‡å®¹å™¨
            document.body.removeChild(tempContainer);
            
            // å¼€å§‹åˆ†é¡µ
            const pages = [];
            let currentPage = [];
            let currentPageHeight = 0;
            let pageIndex = 0;
            
            console.log('\n===== å¼€å§‹åˆ†é¡µ =====');
            
            for (let i = 0; i < paragraphs.length; i++) {
                const para = paragraphs[i];
                const paraInfo = paragraphHeights[i];
                
                // è®¡ç®—å½“å‰é¡µé¢çš„é«˜åº¦é™åˆ¶
                let maxHeight;
                
                if (pageIndex === 0) {
                    // ç¬¬ä¸€é¡µ
                    maxHeight = FIRST_PAGE_HEIGHT_MM * MM_TO_PX;
                } else {
                    // åç»­é¡µï¼ˆä¸æå‰é™åˆ¶ï¼Œç»Ÿä¸€ä½¿ç”¨æ™®é€šé¡µé«˜åº¦ï¼‰
                    maxHeight = PAGE_HEIGHT_MM * MM_TO_PX;
                }
                
                console.log(`\nå¤„ç†æ®µè½${i + 1}: å†…å®¹=${paraInfo.contentHeight.toFixed(2)}px, ä¸‹è¾¹è·=${paraInfo.marginBottom.toFixed(2)}px, å½“å‰é¡µç´¯è®¡=${currentPageHeight.toFixed(2)}px, é¡µé¢${pageIndex + 1}é™åˆ¶=${maxHeight.toFixed(2)}px`);
                
                // åˆ¤æ–­æ˜¯å¦éœ€è¦æ¢é¡µ
                if (currentPage.length > 0) {
                    // å°è¯•1: åŠ ä¸Šå®Œæ•´é«˜åº¦ï¼ˆå†…å®¹+ä¸‹è¾¹è·ï¼‰
                    const heightWithMargin = currentPageHeight + paraInfo.contentHeight + paraInfo.marginBottom;
                    
                    if (heightWithMargin <= maxHeight) {
                        // å¯ä»¥æ”¾å…¥ï¼ŒåŒ…å«ä¸‹è¾¹è·
                        currentPage.push({ text: para, index: i, hasMargin: true });
                        currentPageHeight = heightWithMargin;
                        console.log(`â†’ æ®µè½æ·»åŠ åˆ°é¡µé¢${pageIndex + 1}ï¼ˆå«ä¸‹è¾¹è·ï¼‰ï¼Œæ–°ç´¯è®¡=${currentPageHeight.toFixed(2)}px`);
                    } else {
                        // å°è¯•2: åªåŠ å†…å®¹é«˜åº¦ï¼ˆä¸å«ä¸‹è¾¹è·ï¼‰ï¼Œä½œä¸ºé¡µé¢æœ€åä¸€æ®µ
                        const heightWithoutMargin = currentPageHeight + paraInfo.contentHeight;
                        
                        if (heightWithoutMargin <= maxHeight) {
                            // å¯ä»¥æ”¾å…¥ï¼Œä½†ä½œä¸ºæœ€åä¸€æ®µï¼Œä¸å«ä¸‹è¾¹è·
                            currentPage.push({ text: para, index: i, hasMargin: false });
                            currentPageHeight = heightWithoutMargin;
                            console.log(`â†’ æ®µè½æ·»åŠ åˆ°é¡µé¢${pageIndex + 1}ï¼ˆä¸å«ä¸‹è¾¹è·ï¼Œä½œä¸ºæœ€åæ®µï¼‰ï¼Œç´¯è®¡=${currentPageHeight.toFixed(2)}px`);
                        } else {
                            // å®Œå…¨æ”¾ä¸ä¸‹ï¼Œéœ€è¦æ¢é¡µ
                            console.log(`â†’ æ¢é¡µï¼é¡µé¢${pageIndex + 1}å®Œæˆï¼ŒåŒ…å«${currentPage.length}ä¸ªæ®µè½ï¼Œæ€»é«˜åº¦=${currentPageHeight.toFixed(2)}px`);
                            pages.push({
                                paragraphs: currentPage.map(p => p.text),
                                height: currentPageHeight
                            });
                            
                            // å¼€å§‹æ–°é¡µ
                            currentPage = [{ text: para, index: i, hasMargin: true }];
                            currentPageHeight = paraInfo.contentHeight + paraInfo.marginBottom;
                            pageIndex++;
                            console.log(`â†’ å¼€å§‹é¡µé¢${pageIndex + 1}`);
                        }
                    }
                } else {
                    // ç¬¬ä¸€ä¸ªæ®µè½ï¼Œç›´æ¥æ·»åŠ 
                    currentPage.push({ text: para, index: i, hasMargin: true });
                    currentPageHeight = paraInfo.contentHeight + paraInfo.marginBottom;
                    console.log(`â†’ æ®µè½æ·»åŠ åˆ°é¡µé¢${pageIndex + 1}ï¼ˆé¦–æ®µï¼‰ï¼Œç´¯è®¡=${currentPageHeight.toFixed(2)}px`);
                }
            }
            
            // æ·»åŠ æœ€åä¸€é¡µ
            if (currentPage.length > 0) {
                console.log(`\né¡µé¢${pageIndex + 1}å®Œæˆï¼ˆæœ€åé¡µï¼‰ï¼ŒåŒ…å«${currentPage.length}ä¸ªæ®µè½ï¼Œæ€»é«˜åº¦=${currentPageHeight.toFixed(2)}px`);
                pages.push({
                    paragraphs: currentPage.map(p => p.text),
                    height: currentPageHeight
                });
            }
            
            console.log(`\n===== åˆæ­¥åˆ†é¡µå®Œæˆï¼Œå…±${pages.length}é¡µ =====`);
            
            // æ£€æŸ¥æœ€åä¸€é¡µçš„é«˜åº¦æ˜¯å¦è¶…è¿‡é™åˆ¶
            if (pages.length > 0) {
                const lastPageMaxHeight = LAST_PAGE_HEIGHT_MM * MM_TO_PX;
                const lastPage = pages[pages.length - 1];
                
                console.log(`\næ£€æŸ¥æœ€åé¡µé«˜åº¦: ${lastPage.height.toFixed(2)}px, é™åˆ¶: ${lastPageMaxHeight.toFixed(2)}px`);
                
                if (lastPage.height > lastPageMaxHeight) {
                    console.log(`æœ€åé¡µè¶…å‡ºé™åˆ¶ï¼Œéœ€è¦é‡æ–°åˆ†é…æ®µè½`);
                    
                    // è·å–æœ€åä¸€é¡µçš„æ®µè½
                    const lastPageParagraphs = lastPage.paragraphs;
                    const lastPageStartIndex = paragraphs.length - lastPageParagraphs.length;
                    
                    // ç§»é™¤æœ€åä¸€é¡µï¼Œé‡æ–°åˆ†é…
                    pages.pop();
                    
                    // é‡æ–°åˆ†é…æœ€åä¸€é¡µçš„æ®µè½
                    let newLastPage = [];
                    let newLastPageHeight = 0;
                    
                    for (let i = 0; i < lastPageParagraphs.length; i++) {
                        const para = lastPageParagraphs[i];
                        const paraInfo = paragraphHeights[lastPageStartIndex + i];
                        
                        // å°è¯•æ·»åŠ åˆ°æ–°çš„æœ€åä¸€é¡µ
                        const heightWithMargin = newLastPageHeight + paraInfo.contentHeight + paraInfo.marginBottom;
                        const heightWithoutMargin = newLastPageHeight + paraInfo.contentHeight;
                        
                        if (heightWithMargin <= lastPageMaxHeight) {
                            newLastPage.push(para);
                            newLastPageHeight = heightWithMargin;
                        } else if (heightWithoutMargin <= lastPageMaxHeight) {
                            newLastPage.push(para);
                            newLastPageHeight = heightWithoutMargin;
                        } else {
                            // å½“å‰æ®µè½æ”¾ä¸ä¸‹ï¼Œéœ€è¦æ–°å¼€ä¸€é¡µ
                            // å°†å·²æœ‰æ®µè½ä½œä¸ºå€’æ•°ç¬¬äºŒé¡µ
                            if (newLastPage.length > 0) {
                                pages.push({
                                    paragraphs: newLastPage,
                                    height: newLastPageHeight
                                });
                                console.log(`  æ·»åŠ å€’æ•°ç¬¬äºŒé¡µ: ${newLastPage.length}æ®µ, é«˜åº¦${newLastPageHeight.toFixed(2)}px`);
                            }
                            
                            // å¼€å§‹æ–°çš„æœ€åä¸€é¡µ
                            newLastPage = [para];
                            newLastPageHeight = paraInfo.contentHeight + paraInfo.marginBottom;
                        }
                    }
                    
                    // æ·»åŠ æœ€ç»ˆçš„æœ€åä¸€é¡µ
                    if (newLastPage.length > 0) {
                        pages.push({
                            paragraphs: newLastPage,
                            height: newLastPageHeight
                        });
                        console.log(`  æœ€ç»ˆæœ€åé¡µ: ${newLastPage.length}æ®µ, é«˜åº¦${newLastPageHeight.toFixed(2)}px`);
                    }
                }
            }
            
            console.log(`\n===== åˆ†é¡µå®Œæˆï¼Œå…±${pages.length}é¡µ =====\n`);
            
            // è¿”å›æ®µè½æ•°ç»„æ ¼å¼
            return pages.map(page => page.paragraphs);
        }

        function runTest() {
            const startTime = performance.now();
            
            // è·å–æºå†…å®¹
            const sourceDiv = document.getElementById('sourceContent');
            const title = sourceDiv.querySelector('h1').textContent;
            const chapter = sourceDiv.querySelector('h3').textContent;
            const paragraphs = Array.from(sourceDiv.querySelectorAll('p'))
                .map(p => p.textContent.trim())
                .filter(text => text.length > 0);
            
            console.log(`æ€»æ®µè½æ•°: ${paragraphs.length}`);
            
            // åˆ†é¡µ
            const pages = splitContentIntoPages(paragraphs);
            
            // ç”ŸæˆHTML
            const today = new Date();
            const dateStr = `${today.getFullYear()}å¹´${today.getMonth() + 1}æœˆ${today.getDate()}æ—¥`;
            
            let html = '<div class="document-container">';
            
            // ç¬¬ä¸€é¡µ
            html += `
                <div class="page ${showRuler ? 'with-ruler' : ''}">
                    <div class="header">
                        <div class="header-title">XXçœç½‘ç»œæ–‡å­¦ç®¡ç†å§”å‘˜ä¼š</div>
                        <div class="header-line"></div>
                    </div>
                    <div class="document-number">Xç½‘æ–‡ã€”2026ã€•1å·</div>
                    <div class="title">${chapter}</div>
                    <div class="content">
            `;
            
            if (pages.length > 0) {
                for (let para of pages[0]) {
                    html += `<p>${para}</p>`;
                }
            }
            
            html += `<div class="page-number">â€”1â€”</div></div></div>`;
            
            // åç»­é¡µé¢
            for (let i = 1; i < pages.length; i++) {
                const isLastPage = i === pages.length - 1;
                
                html += `<div class="page ${showRuler ? 'with-ruler' : ''}"><div class="content">`;
                
                for (let para of pages[i]) {
                    html += `<p>${para}</p>`;
                }
                
                if (isLastPage) {
                    html += `</div>
                        <div class="signature">
                            <div class="signature-unit">XXçœç½‘ç»œæ–‡å­¦ç®¡ç†å§”å‘˜ä¼š</div>
                            <div class="signature-date">${dateStr}</div>
                        </div>
                        <div class="page-number">â€”${i + 1}â€”</div>
                    </div>`;
                } else {
                    html += `<div class="page-number">â€”${i + 1}â€”</div></div></div>`;
                }
            }
            
            html += '</div>';
            
            document.getElementById('result').innerHTML = html;
            
            const endTime = performance.now();
            const duration = (endTime - startTime).toFixed(2);
            
            // æ˜¾ç¤ºç»Ÿè®¡ä¿¡æ¯
            document.getElementById('stats').innerHTML = `
                <strong>âœ… æµ‹è¯•å®Œæˆ</strong><br>
                æ€»æ®µè½æ•°: ${paragraphs.length}<br>
                ç”Ÿæˆé¡µæ•°: ${pages.length}<br>
                å¤„ç†æ—¶é—´: ${duration}ms<br>
                ç¬¬ä¸€é¡µæ®µè½æ•°: ${pages[0] ? pages[0].length : 0}<br>
                ${pages.map((p, i) => `ç¬¬${i+1}é¡µ: ${p.length}æ®µ`).join(' | ')}
            `;
            
            console.log(`æµ‹è¯•å®Œæˆï¼Œç”Ÿæˆ${pages.length}é¡µï¼Œè€—æ—¶${duration}ms`);
        }

        function toggleRuler() {
            showRuler = !showRuler;
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => {
                if (showRuler) {
                    page.classList.add('with-ruler');
                } else {
                    page.classList.remove('with-ruler');
                }
            });
        }
    </script>
</body>
</html>
